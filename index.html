<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CloudBar Shop</title>

  <style>
    /* ====== –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò –°–¢–†–ê–ù–ò–¶–´ ====== */
    :root {
      --bg:#0e0f12;
      --card:#14161b;
      --muted:#8ea0b4;
      --accent:#6f3cff;
      --line:#2a2d35;
      --white:#fff;
      --success:#20c997;
    }
    * { box-sizing: border-box }
    html,body{ height:100% }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--white);
    }
    .body-lock{             /* –±–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–π –∫–æ—Ä–∑–∏–Ω–µ */
      overflow:hidden;
    }

    header{
      position:sticky; top:0; z-index:9;
      background:var(--card);
      border-bottom:1px solid var(--line);
      padding:12px 16px;
      display:flex; gap:12px; align-items:center;
    }
    input[type="search"]{
      flex:1; padding:10px 12px;
      border-radius:10px; border:1px solid var(--line);
      background:var(--bg); color:var(--white);
      outline:none;
    }

    /* ====== –¢–∞–±—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π ====== */
    .tabs{
      display:flex; gap:8px;
      flex-wrap:wrap;
      padding:10px 16px;
      border-bottom:1px solid var(--line);
      background:var(--card);
    }
    .tab{
      padding:8px 12px;
      border:1px solid var(--line);
      border-radius:20px;
      cursor:pointer;
      font-size:14px;
      background:#14161b;
      color:#eaeaea;
    }
    .tab.active{
      background:var(--accent);
      border-color:var(--accent);
      color:#fff;
    }

    /* ====== –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ ====== */
    .grid{
      display:grid;
      gap:16px;
      padding:16px;
      grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
    }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      overflow:hidden;
      display:flex; flex-direction:column; gap:8px;
    }
    .card img{ width:100%; aspect-ratio:1/1; object-fit:cover; background:#0e0f12 }
    .card .name{ display:flex; flex-direction:column; gap:6px; padding:12px }
    .name .cat{ color:var(--muted); font-size:13px }
    .price{ font-weight:700 }
    .card .bottom{ display:flex; justify-content:space-between; align-items:center; padding:12px; border-top:1px solid var(--line) }
    button{
      cursor:pointer;
      border:1px solid var(--accent);
      background:var(--accent);
      color:#fff;
      border-radius:10px;
      padding:8px 12px;
    }
    .muted{ opacity:.7 }

    /* ====== –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ "–ö–æ—Ä–∑–∏–Ω–∞" ====== */
    .cartFab{
      position:fixed; right:16px; bottom:16px;
      background:var(--accent); color:#fff; border:none;
      border-radius:20px; padding:12px 14px; font-weight:700;
      z-index:5;
    }

    /* ====== –í–´–ï–ó–ñ–ê–Æ–©–ê–Ø –ö–û–†–ó–ò–ù–ê ====== */
    .drawer{
      position: fixed;
      right: 0; top: 0; bottom: 0;
      width: 380px; max-width: 100%;
      background: var(--card);
      border-left:1px solid var(--line);
      transform: translateX(100%);    /* —Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
      transition: transform .25s ease;
      z-index: 10;
      display:flex; flex-direction:column;
    }
    .drawer.open{ transform: translateX(0) }

    .drawer header{
      position: sticky; top: 0;
      display:flex; align-items:center; justify-content:space-between;
      background:var(--card);
      padding:12px 16px; z-index:1;
      border-bottom:1px solid var(--line);
    }
    .drawer header .close{
      width:34px; height:34px;
      border:0; border-radius:8px; cursor:pointer;
      background:var(--line); color:#fff;
    }

    .drawer .list{ padding:12px; display:flex; flex-direction:column; gap:10px; overflow:auto }
    .row{ display:flex; gap:10px; align-items:center; justify-content:space-between; border:1px solid var(--line); border-radius:12px; padding:10px }
    .qty{ display:flex; gap:6px; align-items:center }
    .qty button{ width:28px; height:28px; border-radius:8px; padding:0; background:var(--line) }
    .total{ padding:12px; border-top:1px solid var(--line); font-weight:700 }

    .form{ display:flex; flex-direction:column; gap:10px; padding:12px }
    .form input, .form select, .form textarea{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--line);
      background:var(--bg); color:#fff; outline:none;
    }

    /* ====== –û–í–ï–†–õ–ï–ô ====== */
    .overlay{
      position:fixed; inset:0;
      background:#0008;
      opacity:0; pointer-events:none;
      transition:opacity .25s;
      z-index: 9;
    }
    .overlay_show{ opacity:1; pointer-events:auto }

    /* –ø–æ–ª–µ–∑–Ω—ã–µ –º–µ–ª–æ—á–∏ */
    .hidden{ display:none }
  </style>
</head>
<body>

  <!-- –ü–æ–∏—Å–∫ + –∫–Ω–æ–ø–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã -->
  <header>
    <input id="q" type="search" placeholder="–ü–æ–∏—Å–∫..." />
    <button id="openCart" class="cartFab">üõí –ö–æ—Ä–∑–∏–Ω–∞</button>
  </header>

  <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
  <div class="tabs" id="tabs"></div>

  <!-- –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
  <main class="grid" id="grid"></main>

  <!-- –í—ã–µ–∑–∂–∞—é—â–∞—è –∫–æ—Ä–∑–∏–Ω–∞ -->
  <aside class="drawer" id="cart">
    <header>
      <div style="font-weight:700">–ö–æ—Ä–∑–∏–Ω–∞</div>
      <button id="closeCart" class="close">‚úï</button>
    </header>

    <div class="list" id="cartList"></div>
    <div class="total">–ò—Ç–æ–≥–æ: <span id="totalBox">0 Kƒç</span></div>

    <!-- –§–æ—Ä–º–∞ –∑–∞–∫–∞–∑–∞ -->
    <form class="form" id="orderForm">
      <select id="pay">
        <option value="–û–Ω–ª–∞–π–Ω-–ø–µ—Ä–µ–≤–æ–¥–æ–º">–û–Ω–ª–∞–π–Ω-–ø–µ—Ä–µ–≤–æ–¥–æ–º</option>
        <option value="–ù–∞–ª–∏—á–Ω—ã–º–∏ –∫—É—Ä—å–µ—Ä—É">–ù–∞–ª–∏—á–Ω—ã–º–∏ –∫—É—Ä—å–µ—Ä—É</option>
      </select>
      <select id="delivery">
        <option value="–î–æ—Å—Ç–∞–≤–∫–∞">–î–æ—Å—Ç–∞–≤–∫–∞</option>
        <option value="–°–∞–º–æ–≤—ã–≤–æ–∑">–°–∞–º–æ–≤—ã–≤–æ–∑</option>
      </select>
      <input id="fio" placeholder="–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è" />
      <input id="tg"  placeholder="@username –≤ Telegram (–ø–æ –∂–µ–ª–∞–Ω–∏—é)" />
      <input id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" />
      <input id="addr" placeholder="–ê–¥—Ä–µ—Å" />
      <textarea id="comment" rows="3" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>
      <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </form>
  </aside>

  <!-- –û–≤–µ—Ä–ª–µ–π -->
  <div class="overlay" id="overlay"></div>

  <script>
    /***********************
     * –ù–ê–°–¢–†–û–ô–ö–ò/–î–ê–ù–ù–´–ï
     ***********************/
    // TODO: —Å—é–¥–∞ –≤—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à URL –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Apps Script (Deploy ‚Üí Web app ‚Üí URL)
    const GAS_URL = 'PASTE_YOUR_APPS_SCRIPT_WEBAPP_URL_HERE';

    const categories = [
      { id:'all', name:'–í—Å–µ' },
      { id:'bbg', name:'VOEX Blueberry Bubble Gum' },
      { id:'coc', name:'VOEX Blueberry Coconut' },
      { id:'ggr', name:'VOEX Green Grape Rose' },
      { id:'jas', name:'VOEX Jasmine Raspberry' },
      { id:'pink',name:'VOEX Pink Lemonade' },
    ];

    // –í–ê–ñ–ù–û: –∏–º–µ–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ñ–∞–π–ª–∞–º–∏ –≤ /img/
    const products = [
      { id:1, cat:'bbg', name:'VOEX Blueberry Bubble Gum', sub:'–ß–µ—Ä–Ω–∏—á–Ω–∞—è –∂–µ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Ä–µ–∑–∏–Ω–∫–∞', price:300, img:'blueberry-bubble-gum.jpg.jpg' },
      { id:2, cat:'coc', name:'VOEX Blueberry Coconut',     sub:'–ß–µ—Ä–Ω–∏–∫–∞ –ö–æ–∫–æ—Å',                 price:300, img:'blueberry-coconut.jpg.jpg'   },
      { id:3, cat:'ggr', name:'VOEX Green Grape Rose',       sub:'–ó–µ–ª—ë–Ω–∞—è –≤–∏–Ω–æ–≥—Ä–∞–¥–Ω–∞—è —Ä–æ–∑–∞',      price:300, img:'green-grape-rose.jpg.jpg'  },
      { id:4, cat:'jas', name:'VOEX Jasmine Raspberry',      sub:'–ñ–∞—Å–º–∏–Ω–æ–≤–∞—è –º–∞–ª–∏–Ω–∞',             price:300, img:'jasmine-raspberry.jpg.jpg' },
      { id:5, cat:'pink',name:'VOEX Pink Lemonade',          sub:'–†–æ–∑–æ–≤—ã–π –ª–∏–º–æ–Ω–∞–¥',               price:300, img:'pink-lemonade.jpg.jpg'     },
    ];

    const state = {
      cat:'all',
      q:'',
      cart: [] // {id, qty}
    };

    /* ===== –£—Ç–∏–ª–∏—Ç—ã ===== */
    const money = v => `${v} Kƒç`;
    const byId = id => document.getElementById(id);
    const productById = id => products.find(p => p.id === id);

    /* ===== –†–µ–Ω–¥–µ—Ä —Ç–∞–±–æ–≤ ===== */
    function renderTabs(){
      const tabs = byId('tabs');
      tabs.innerHTML = categories.map(c => `
        <button class="tab ${state.cat===c.id?'active':''}" data-cat="${c.id}">
          ${c.name}
        </button>
      `).join('');
    }

    /* ===== –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Ä–µ–Ω–¥–µ—Ä —Å–µ—Ç–∫–∏ ===== */
    function filt(p){
      const byCat = state.cat==='all' || p.cat===state.cat;
      const byQ   = !state.q || (p.name.toLowerCase()+p.sub.toLowerCase()).includes(state.q);
      return byCat && byQ;
    }

    function renderGrid(){
      const grid = byId('grid');
      const items = products.filter(filt);
      grid.innerHTML = items.map(it => `
        <article class="card">
          <img src="./img/${it.img}" alt="${it.name}" />
          <div class="name">
            <div class="cat">${categories.find(c=>c.id===it.cat)?.name ?? ''}</div>
            <div>${it.name}</div>
            <div class="muted">${it.sub}</div>
          </div>
          <div class="bottom">
            <b class="price">${money(it.price)}</b>
            <button onclick="add(${it.id})">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
          </div>
        </article>
      `).join('');
    }

    /* ===== –ö–æ—Ä–∑–∏–Ω–∞ ===== */
    function add(id){
      const row = state.cart.find(r=>r.id===id);
      if(row) row.qty++;
      else state.cart.push({id, qty:1});
      renderCart();
    }
    function inc(id){ const r=state.cart.find(x=>x.id===id); if(r){ r.qty++; renderCart();}}
    function dec(id){ const r=state.cart.find(x=>x.id===id); if(!r) return; r.qty--; if(r.qty<=0) state.cart = state.cart.filter(x=>x.id!==id); renderCart();}

    function renderCart(){
      const list = byId('cartList');
      if(!state.cart.length){
        list.innerHTML = `<div class="muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div>`;
      }else{
        list.innerHTML = state.cart.map(item=>{
          const p = productById(item.id);
          return `
            <div class="row">
              <div style="flex:1">
                <div style="font-weight:700">${p.name}</div>
                <div class="muted">${p.sub}</div>
              </div>
              <div class="qty">
                <button onclick="dec(${p.id})">‚àí</button>
                <b>${item.qty}</b>
                <button onclick="inc(${p.id})">+</button>
              </div>
              <div style="width:80px; text-align:right"><b>${money(p.price*item.qty)}</b></div>
            </div>
          `;
        }).join('');
      }

      const total = state.cart.reduce((s,i)=> s + productById(i.id).price * i.qty, 0);
      byId('totalBox').textContent = money(total);
    }

    /* ===== –û–¢–ö–†–´–¢–ò–ï/–ó–ê–ö–†–´–¢–ò–ï –ö–û–†–ó–ò–ù–´ (—Å –æ–≤–µ—Ä–ª–µ–µ–º) ===== */
    const cartEl   = byId('cart');
    const overlay  = byId('overlay');
    const openBtn  = byId('openCart');
    const closeBtn = byId('closeCart');

    function openCart(){
      cartEl.classList.add('open');
      overlay.classList.add('overlay_show');
      document.body.classList.add('body-lock');
    }
    function closeCart(){
      cartEl.classList.remove('open');
      overlay.classList.remove('overlay_show');
      document.body.classList.remove('body-lock');
    }

    openBtn  && openBtn.addEventListener('click', openCart);
    closeBtn && closeBtn.addEventListener('click', closeCart);
    overlay.addEventListener('click', closeCart);
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeCart(); });

    /* ===== –ü–æ–∏—Å–∫/—Ç–∞–±—ã ===== */
    byId('q').addEventListener('input', (e)=>{ state.q = e.target.value.trim().toLowerCase(); renderGrid(); });
    byId('tabs').addEventListener('click', (e)=>{
      const btn = e.target.closest('.tab'); if(!btn) return;
      state.cat = btn.dataset.cat; renderTabs(); renderGrid();
    });

    /* ===== –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞ –≤ Apps Script ===== */
    byId('orderForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(!state.cart.length){ alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'); return; }

      const payload = {
        items: state.cart.map(i=>{
          const p = productById(i.id);
          return { id:p.id, title:p.name, qty:i.qty, price_total:p.price*i.qty, currency:'Kƒç' }
        }),
        data:{
          payment: byId('pay').value,
          delivery: byId('delivery').value,
          customer:{
            name: byId('fio').value || '-',
            username: byId('tg').value || '-',
            phone: byId('phone').value || '-',
            address: byId('addr').value || '-',
          },
          comment: byId('comment').value || '-'
        }
      };

      try{
        const resp = await fetch(GAS_URL, {
          method:'POST',
          mode:'no-cors',                // —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–æ—Å—å CORS –≤ GH Pages
          body: JSON.stringify(payload)
        });
        // –î–∞–∂–µ –ø—Ä–∏ no-cors –±—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å "opaque". –°—á–∏—Ç–∞–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º.
        alert('‚úÖ –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!');
        state.cart = []; renderCart(); closeCart();
      }catch(err){
        console.error(err);
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Apps Script URL.');
      }
    });

    /* ===== –ü–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä ===== */
    renderTabs(); renderGrid(); renderCart();
  </script>
</body>
</html>
