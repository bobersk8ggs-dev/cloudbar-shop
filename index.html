<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CloudBar Shop</title>
<style>/* –í—ã–µ–∑–∂–∞—é—â–∞—è –∫–æ—Ä–∑–∏–Ω–∞ */
.drawer{
  position: fixed;
  right: 0; top: 0; bottom: 0;
  width: 380px; max-width: 100%;
  background:#14161b;
  border-left:1px solid #2a2d35;
  transform: translateX(100%);        /* —Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
  transition: transform .25s ease;
  z-index: 1000;
}
.drawer_open{ transform: translateX(0); }

/* –®–∞–ø–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã */
.drawer header{
  position: sticky; top: 0;
  display:flex; align-items:center; justify-content:space-between;
  background:#14161b;
  padding:12px 16px; z-index:1;
}
.drawer header .close{
  width:34px; height:34px;
  border:0; border-radius:8px; cursor:pointer;
  background:#2a2d35; color:#fff;
}

/* –û–≤–µ—Ä–ª–µ–π –ø–æ–¥ –∫–æ—Ä–∑–∏–Ω–æ–π */
.overlay{
  position:fixed; inset:0;
  background:#0008;
  opacity:0; pointer-events:none;
  transition:opacity .2s;
  z-index: 999;
}
.overlay_show{ opacity:1; pointer-events:auto }

  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#0e0f12;color:#eaeaea}
  header{position:sticky;top:0;background:#14161b;border-bottom:1px solid #222;padding:12px 16px;display:flex;gap:12px;align-items:center;z-index:9}
  input[type=search]{flex:1;padding:10px 12px;border-radius:10px;border:1px solid #2a2d35;background:#0e0f12;color:#eaeaea}
  .tabs{display:flex;gap:8px;flex-wrap:wrap;padding:10px 16px;border-bottom:1px solid #222}
  .tab{padding:8px 12px;border:1px solid #2a2d35;border-radius:20px;cursor:pointer;font-size:14px;background:#14161b}
  .tab.active{background:#6f3cff;border-color:#6f3cff;color:#fff}
  .grid{display:grid;gap:16px;padding:16px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
  .card{border:1px solid #2a2d35;border-radius:16px;background:#14161b;overflow:hidden;display:flex;flex-direction:column}
  .card img{width:100%;aspect-ratio:1/1;object-fit:cover;background:#0e0f12}
  .card .p{padding:12px;display:flex;flex-direction:column;gap:6px}
  .price{font-weight:700}
  button{cursor:pointer;border:1px solid #6f3cff;background:#6f3cff;color:#fff;border-radius:10px;padding:8px 10px}
  .muted{opacity:.7}
  .cartfab{position:fixed;right:16px;bottom:16px;background:#6f3cff;color:#fff;border:none;border-radius:20px;padding:12px 14px;font-weight:700}
  .drawer{position:fixed;right:0;top:0;bottom:0;width:380px;max-width:100%;background:#14161b;border-left:1px solid #2a2d35;transform:translateX(100%);transition:.25s;z-index:10;display:flex;flex-direction:column}
  .drawer.open{transform:none}
  .drawer header{position:sticky;top:0}
  .cartlist{padding:12px;display:flex;flex-direction:column;gap:10px;overflow:auto}
  .row{display:flex;gap:10px;align-items:center;justify-content:space-between;border:1px solid #2a2d35;border-radius:12px;padding:10px}
  .qty{display:flex;gap:6px;align-items:center}
  .qty button{padding:2px 8px;border-radius:6px;background:#222;border-color:#333}
  form{display:flex;flex-direction:column;gap:10px;padding:12px}
  input,select,textarea{background:#0e0f12;color:#eaeaea;border:1px solid #2a2d35;border-radius:10px;padding:10px}
  .total{padding:12px;border-top:1px solid #222;font-weight:700}
</style>
</head>
<body>
<header>
  <input id="q" type="search" placeholder="–ü–æ–∏—Å–∫..." />
  <button id="openCart">–ö–æ—Ä–∑–∏–Ω–∞</button>
</header>

<div class="tabs" id="tabs"></div>
<div class="grid" id="grid"></div>

<button class="cartfab" id="fab">üß∫ –ö–æ—Ä–∑–∏–Ω–∞</button>

<aside class="drawer" id="drawer">
  <header>–ö–æ—Ä–∑–∏–Ω–∞</header>
  <div class="cartlist" id="cart"></div>
  <div class="total" id="total"></div>
  <form id="order">
    <select name="payment">
      <option>–û–Ω–ª–∞–π–Ω-–ø–µ—Ä–µ–≤–æ–¥–æ–º</option>
      <option>–ù–∞–ª–∏—á–Ω—ã–º–∏ –∫—É—Ä—å–µ—Ä—É</option>
    </select>
    <select name="delivery">
      <option>–î–æ—Å—Ç–∞–≤–∫–∞</option>
      <option>–°–∞–º–æ–≤—ã–≤–æ–∑</option>
    </select>
    <input name="name" placeholder="–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è" required />
    <input name="username" placeholder="@username –≤ Telegram (–ø–æ –∂–µ–ª–∞–Ω–∏—é)" />
    <input name="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" />
    <input name="address" placeholder="–ê–¥—Ä–µ—Å" />
    <textarea name="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>
    <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </form>
</aside>

<script>
/* ====== –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ====== */
const ENDPOINT = 'https://script.google.com/macros/s/AKfycbx4P7kHLxXLoKydNMzkqOumae5FpXyNACs1iI7MbBSsDBNNpvQsSby0njaB3BjNbMeRsQ/exec';  // <-- –ø–æ—Å—Ç–∞–≤—å URL –∏–∑ Apps Script
const CURRENCY = 'Kƒç';                         // –≤–∞–ª—é—Ç–∞ –¥–ª—è —Ü–µ–Ω

/* ====== –¢–æ–≤–∞—Ä—ã (–ø—Ä–∏–º–µ—Ä) ====== */
const PRODUCTS = [
  { id:'blueberry-bubble-gum', title:'–ß–µ—Ä–Ω–∏—á–Ω–∞—è –∂–µ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Ä–µ–∑–∏–Ω–∫–∞',  price:300, cat:'VOEX Blueberry Bubble Gum',  img:'img/blueberry-bubble-gum.jpg.jpg' },
  { id:'blueberry-coconut',    title:'–ß–µ—Ä–Ω–∏–∫–∞ –ö–æ–∫–æ—Å',     price:300, cat:'VOEX Blueberry Coconut',  img:'img/blueberry-coconut.jpg.jpg' },
  { id:'green-grape-rose',     title:'–ó–µ–ª–µ–Ω–∞—è –≤–∏–Ω–æ–≥—Ä–∞–¥–Ω–∞—è —Ä–æ–∑–∞',      price:300, cat:'VOEX Green Grape Rose', img:'img/green-grape-rose.jpg.jpg' },
  { id:'jasmine-raspberry',    title:'–ñ–∞—Å–º–∏–Ω–æ–≤–∞—è –º–∞–ª–∏–Ω–∞',     price:300, cat:'VOEX Jasmine Raspberry', img:'img/jasmine-raspberry.jpg.jpg' },
  { id:'pink-lemonade',        title:'–†–æ–∑–æ–≤—ã–π –ª–∏–º–æ–Ω–∞–¥',         price:300, cat:'VOEX Pink Lemonade', img:'img/pink-lemonade.jpg.jpg' },
];

let state = {cat:'–í—Å–µ', q:'', cart:{}};
const cats = ['–í—Å–µ', ...[...new Set(PRODUCTS.map(p => p.cat))]];
const $ = s => document.querySelector(s);
const grid = $('#grid'), tabs = $('#tabs'), q = $('#q');
const drawer = $('#drawer'), cartBox = $('#cart'), totalBox = $('#total');

function money(x){ return `${x} ${CURRENCY}`; }
function filtered(){
  return PRODUCTS.filter(p =>
    (state.cat==='–í—Å–µ' || p.cat===state.cat) &&
    (state.q==='' || p.title.toLowerCase().includes(state.q.toLowerCase()))
  );
}
function renderTabs(){
  tabs.innerHTML = cats.map(c =>
    `<div class="tab ${state.cat===c?'active':''}" data-cat="${c}">${c}</div>`
  ).join('');
}
function renderGrid(){
  grid.innerHTML = filtered().map(p => `
    <div class="card">
      <img src="${p.img}" alt="">
      <div class="p">
        <div class="muted">${p.cat}</div>
        <div>${p.title}</div>
        <div class="price">${money(p.price)}</div>
        <button onclick="add('${p.id}')">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
      </div>
    </div>`).join('');
}
function add(id){ state.cart[id]=(state.cart[id]||0)+1; renderCart(); openCart(); }
function dec(id){ if(state.cart[id]>1) state.cart[id]--; else delete state.cart[id]; renderCart(); }
function renderCart(){
  const items = Object.entries(state.cart).map(([id,qty])=>{
    const p = PRODUCTS.find(x=>x.id===id);
    return {...p, qty, sum: p.price*qty};
  });
  cartBox.innerHTML = items.length? items.map(it=>`
    <div class="row">
      <div style="flex:1">
        <div class="muted">${it.cat}</div>
        <div>${it.title}</div>
        <div class="muted">${money(it.price)} √ó ${it.qty}</div>
      </div>
      <div class="qty">
        <button onclick="dec('${it.id}')">-</button>
        <b>${it.qty}</b>
        <button onclick="add('${it.id}')">+</button>
      </div>
      <b>${money(it.sum)}</b>
    </div>`).join('') : '<div class="muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div>';
  const total = items.reduce((s,i)=>s+i.sum,0);
  totalBox.textContent = '–ò—Ç–æ–≥–æ: '+ money(total);
}
// –¥–æ–±–∞–≤—å —Ä—è–¥–æ–º —Å –¥—Ä—É–≥–∏–º–∏ const'–∞–º–∏:
const overlay = document.getElementById('overlay');
const openBtn  = document.getElementById('openCart');   // –µ—Å–ª–∏ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–æ—Ä–∑–∏–Ω—É
const closeBtn = document.getElementById('closeCart');  // –µ—Å–ª–∏ –µ—Å—Ç—å –∫—Ä–µ—Å—Ç–∏–∫ –≤ —à–∞–ø–∫–µ –∫–æ—Ä–∑–∏–Ω—ã

function openCart() {
  drawer.classList.add('open');          // —Ç–≤–æ–π –∫–ª–∞—Å—Å –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–Ω–µ–ª–∏
  overlay.classList.add('overlay_show'); // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ
  document.body.classList.add('body-lock'); // –±–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
}

function closeCart() {
  drawer.classList.remove('open');
  overlay.classList.remove('overlay_show');
  document.body.classList.remove('body-lock');
}

// –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (–µ—Å–ª–∏ –∏—Ö –µ—â—ë –Ω–µ—Ç –Ω–∏–∂–µ –ø–æ –∫–æ–¥—É)
openBtn  && openBtn.addEventListener('click', openCart);
closeBtn && closeBtn.addEventListener('click', closeCart);
overlay.addEventListener('click', closeCart);
document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeCart(); });


tabs.addEventListener('click',e=>{
  const cat=e.target.dataset.cat; if(!cat) return;
  state.cat=cat; renderTabs(); renderGrid();
});
q.addEventListener('input', e=>{ state.q=e.target.value; renderGrid(); });
$('#fab').onclick=$('#openCart').onclick=openCart;
document.addEventListener('keydown',e=>{ if(e.key==='Escape') closeCart(); });

$('#order').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const form = Object.fromEntries(new FormData(e.target).entries());
  const items = Object.entries(state.cart).map(([id,qty])=>{
    const p = PRODUCTS.find(x=>x.id===id);
    return {title:p.title, qty, price:p.price, price_total:p.price*qty};
  });
  const total = items.reduce((s,i)=>s+i.price_total,0);
  const payload = {
    currency: CURRENCY,
    items, total,
    payment: form.payment,
    delivery: form.delivery,
    customer: {
      name: form.name,
      username: form.username?.replace(/^@/,''),
      phone: form.phone,
      address: form.address,
      comment: form.comment
    }
  };
  try{
    const r = await fetch(ENDPOINT,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const j = await r.json();
    if(j.ok){
      alert('–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ Telegram.');
      state.cart={}; renderCart(); closeCart();
    }else{
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑: '+(j.error||''));
    }
  }catch(err){
    alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: '+err.message);
  }
});

renderTabs(); renderGrid(); renderCart();
</script><!-- –û–≤–µ—Ä–ª–µ–π (–æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É) -->
<div class="overlay" id="overlay"></div>

<script>
  const cart     = document.getElementById('cart');
  const overlay  = document.getElementById('overlay');
  const openBtn  = document.getElementById('openCart');  // –∫–Ω–æ–ø–∫–∞ "–ö–æ—Ä–∑–∏–Ω–∞"
  const closeBtn = document.getElementById('closeCart');  // –∫–Ω–æ–ø–∫–∞ ‚úï –≤ —à–∞–ø–∫–µ –∫–æ—Ä–∑–∏–Ω—ã

  function openCart() {
    cart.classList.add('drawer_open');
    overlay.classList.add('overlay_show');
  }
  function closeCart() {
    cart.classList.remove('drawer_open');
    overlay.classList.remove('overlay_show');
  }

  if (openBtn)  openBtn.addEventListener('click', openCart);
  if (closeBtn) closeBtn.addEventListener('click', closeCart);
  overlay.addEventListener('click', closeCart);

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeCart();
  });
</script>

</body>
</html>
