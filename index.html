<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CloudBar Shop</title>

  <style>
    :root{
      --bg:#0e0f12;
      --panel:#14161b;
      --muted:#a8abb2;
      --text:#eaeaea;
      --brand:#6f3cff;
      --border:#2a2d35;
      --accent:#7d5dff;
      --danger:#ff4d6d;
      --ok:#3bd671;
    }

    * { box-sizing: border-box; }
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      margin:0; background:var(--bg); color:var(--text);
    }

    header{
      position:sticky; top:0;
      background:var(--panel); border-bottom:1px solid var(--border);
      padding:12px 16px; display:flex; gap:12px; align-items:center; z-index:9;
    }
    input[type=search]{
      flex:1; padding:10px 12px; border-radius:10px;
      border:1px solid var(--border); background:var(--bg); color:var(--text);
    }

    .tabs{ display:flex; gap:8px; flex-wrap:wrap; padding:10px 16px; border-bottom:1px solid var(--border); }
    .tab{ padding:8px 12px; border:1px solid var(--border); border-radius:20px; cursor:pointer; font-size:14px; background:var(--panel); }
    .tab.active{ background:var(--brand); border-color:var(--brand); color:#fff; }

    .grid{
      display:grid; gap:16px; padding:16px;
      grid-template-columns:repeat(auto-fill,minmax(230px,1fr));
    }

    .card{
      border:1px solid var(--border); border-radius:16px; background:var(--panel);
      overflow:hidden; display:flex; flex-direction:column;
    }
    .card img{ width:100%; aspect-ratio:1/1; object-fit:cover; background:#0e0f12; }
    .card .name{ padding:12px; display:flex; flex-direction:column; gap:6px; }
    .price{ font-weight:700; }
    button{ cursor:pointer; border:1px solid var(--brand); background:var(--brand); color:#fff; border-radius:10px; padding:8px 10px; }
    .muted{ opacity:.7; }

    /* ===== Drawer (–∫–æ—Ä–∑–∏–Ω–∞) ===== */
    .drawer{
      position:fixed; right:0; top:0; bottom:0;
      width:380px; max-width:100%;
      background:var(--panel);
      border-left:1px solid var(--border);
      transform:translateX(100%);            /* —Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
      transition:transform .25s ease;
      z-index:1000;
      display:flex; flex-direction:column;
    }
    .drawer_open{ transform:translateX(0); }

    .drawer header{
      position: sticky; top:0;
      display:flex; align-items:center; justify-content:space-between;
      background:var(--panel); padding:12px 16px; z-index:1; border-bottom:1px solid var(--border);
    }
    .drawer header .close{
      width:34px; height:34px; border:0; border-radius:8px; cursor:pointer; background:var(--border); color:#fff;
    }

    .cartlist{ padding:12px; display:flex; flex-direction:column; gap:10px; overflow:auto; }
    .row{ display:flex; gap:10px; align-items:center; justify-content:space-between; border:1px solid var(--border); border-radius:12px; padding:10px; }
    .qty{ display:flex; gap:6px; align-items:center; }
    .qty button{ padding:6px 8px; border-radius:8px; }
    .total{ padding:12px; border-top:1px solid var(--border); font-weight:700; }

    .form{ padding:12px; display:flex; flex-direction:column; gap:10px; }
    .form input, .form select, .form textarea{
      padding:10px; border-radius:10px; border:1px solid var(--border); background:var(--bg); color:var(--text);
    }
    .form textarea{ min-height:90px; resize:vertical; }

    .danger{ border-color:var(--danger) !important; }

    /* ===== Overlay ===== */
    .overlay{
      position:fixed; inset:0; background:#0008;
      opacity:0; pointer-events:none; transition:opacity .2s; z-index:999;
    }
    .overlay_show{ opacity:1; pointer-events:auto; }

    /* FAB –∫–æ—Ä–∑–∏–Ω—ã */
    .fab{
      position:fixed; right:16px; bottom:16px;
      background:var(--brand); color:#fff; border:none; border-radius:20px; padding:12px 14px; font-weight:700;
      box-shadow:0 6px 24px #0006;
      z-index:3;
    }
  </style>
</head>
<body>

  <header>
    <input id="search" type="search" placeholder="–ü–æ–∏—Å–∫..." />
  </header>

  <div class="tabs" id="tabs"></div>
  <div class="grid" id="grid"></div>

  <!-- –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ "–ö–æ—Ä–∑–∏–Ω–∞" -->
  <button class="fab" id="openCart">üõí –ö–æ—Ä–∑–∏–Ω–∞</button>

  <!-- Overlay -->
  <div class="overlay" id="overlay"></div>

  <!-- Drawer (–∫–æ—Ä–∑–∏–Ω–∞) -->
  <aside class="drawer" id="cart">
    <header>
      <b>–ö–æ—Ä–∑–∏–Ω–∞</b>
      <button class="close" id="closeCart">‚úï</button>
    </header>

    <div class="cartlist" id="cartList"></div>
    <div class="total">–ò—Ç–æ–≥–æ: <span id="totalBox">0 Kƒç</span></div>

    <form class="form" id="orderForm">
      <select name="payment">
        <option>–û–Ω–ª–∞–π–Ω-–ø–µ—Ä–µ–≤–æ–¥–æ–º</option>
        <option>–ù–∞–ª–∏—á–Ω—ã–º–∏ –∫—É—Ä—å–µ—Ä—É</option>
      </select>
      <select name="delivery">
        <option>–î–æ—Å—Ç–∞–≤–∫–∞</option>
        <option>–°–∞–º–æ–≤—ã–≤–æ–∑</option>
      </select>

      <input type="text"   name="name"      placeholder="–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è" required />
      <input type="text"   name="username"  placeholder="@username –≤ Telegram (–ø–æ –∂–µ–ª–∞–Ω–∏—é)" />
      <input type="tel"    name="phone"     placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required />
      <input type="text"   name="address"   placeholder="–ê–¥—Ä–µ—Å" />
      <textarea            name="comment"   placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>

      <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </form>
  </aside>

  <script>
    /* =====================================================================
       1) –ù–ê–°–¢–†–û–ô–ö–ê ‚Äî –ø–æ–¥—Å—Ç–∞–≤—å URL –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Google Apps Script
       ===================================================================== */
    const API_URL = 'https://script.google.com/macros/s/AKfycbx4P7kHLxXLoKydNMzkqOumae5FpXyNACs1iI7MbBSsDBNNpvQsSby0njaB3BjNbMeRsQ/exec';
    //                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    // –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π URL –∏–∑ Deploy ‚Üí Web app ‚Üí URL


    /* ======================== 2) –î–ê–ù–ù–´–ï ======================== */
    const categories = [
      { id: 'all', name: '–í—Å–µ' },
      { id: 'VOEX Blueberry Bubble Gum', name: 'VOEX Blueberry Bubble Gum' },
      { id: 'VOEX Blueberry Coconut',    name: 'VOEX Blueberry Coconut' },
      { id: 'VOEX Green Grape Rose',     name: 'VOEX Green Grape Rose' },
      { id: 'VOEX Jasmine Raspberry',    name: 'VOEX Jasmine Raspberry' },
      { id: 'VOEX Pink Lemonade',        name: 'VOEX Pink Lemonade' }
    ];

    const products = [
      {
        id: 'p1',
        cat: 'VOEX Blueberry Bubble Gum',
        title: 'VOEX Blueberry Bubble Gum',
        subtitle: '–ß–µ—Ä–Ω–∏—á–Ω–∞—è –∂–µ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Ä–æ–∑–∏–Ω–∫–∞',
        price: 300,
        img: 'img/blueberry-bubble-gum.jpg.jpg'
      },
      {
        id: 'p2',
        cat: 'VOEX Blueberry Coconut',
        title: 'VOEX Blueberry Coconut',
        subtitle: '–ß–µ—Ä–Ω–∏–∫–∞ –ö–æ–∫–æ—Å',
        price: 300,
        img: 'img/blueberry-coconut.jpg.jpg'
      },
      {
        id: 'p3',
        cat: 'VOEX Green Grape Rose',
        title: 'VOEX Green Grape Rose',
        subtitle: '–ó–µ–ª—ë–Ω–∞—è –≤–∏–Ω–æ–≥—Ä–∞–¥–Ω–∞—è —Ä–æ–∑–∞',
        price: 300,
        img: 'img/green-grape-rose.jpg.jpg'
      },
      {
        id: 'p4',
        cat: 'VOEX Jasmine Raspberry',
        title: 'VOEX Jasmine Raspberry',
        subtitle: '–ñ–∞—Å–º–∏–Ω–æ–≤–∞—è –º–∞–ª–∏–Ω–∞',
        price: 300,
        img: 'img/jasmine-raspberry.jpg.jpg'
      },
      {
        id: 'p5',
        cat: 'VOEX Pink Lemonade',
        title: 'VOEX Pink Lemonade',
        subtitle: '–†–æ–∑–æ–≤—ã–π –ª–∏–º–æ–Ω–∞–¥',
        price: 300,
        img: 'img/pink-lemonade.jpg.jpg'
      }
    ];

    /* ======================== 3) STATE ======================== */
    const state = {
      cat: 'all',
      search: '',
      cart: []  // {id,title,qty,price}
    };

    const $ = sel => document.querySelector(sel);
    const tabs = $('#tabs');
    const grid = $('#grid');
    const search = $('#search');

    /* ======================== 4) –†–ï–ù–î–ï–† ======================== */
    function money(v){ return `${v} Kƒç`; }

    function renderTabs(){
      tabs.innerHTML = categories.map(c => `
        <div class="tab ${state.cat===c.id?'active':''}" data-cat="${c.id}">${c.name}</div>
      `).join('');
    }

    function filtered(){
      const q = state.search.trim().toLowerCase();
      return products.filter(p =>
        (state.cat==='all'||p.cat===state.cat) &&
        (!q || p.title.toLowerCase().includes(q) || p.subtitle.toLowerCase().includes(q))
      );
    }

    function renderGrid(){
      const list = filtered();
      grid.innerHTML = list.map(it => `
        <div class="card">
          <img src="${it.img}" alt="${it.title}" />
          <div class="name">
            <div class="muted">${it.cat}</div>
            <b>${it.title}</b>
            <div class="muted">${it.subtitle}</div>
            <div class="price">${money(it.price)}</div>
            <button onclick="add('${it.id}')">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
          </div>
        </div>
      `).join('');
    }

    /* ======================== 5) –ö–û–†–ó–ò–ù–ê ======================== */
    function add(id){
      const prod = products.find(p=>p.id===id);
      if(!prod) return;
      const row = state.cart.find(x=>x.id===id);
      if(row) row.qty += 1;
      else state.cart.push({ id, title: prod.title, price: prod.price, qty:1 });

      renderCart();
      openCart();
    }

    function dec(id){
      const row = state.cart.find(x=>x.id===id);
      if(!row) return;
      row.qty -= 1;
      if(row.qty<=0) state.cart = state.cart.filter(x=>x.id!==id);
      renderCart();
    }
    function inc(id){
      const row = state.cart.find(x=>x.id===id);
      if(row) row.qty += 1;
      renderCart();
    }

    const cartList = $('#cartList');
    const totalBox = $('#totalBox');

    function renderCart(){
      if(!state.cart.length){
        cartList.innerHTML = `<div class="muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div>`;
        totalBox.textContent = money(0);
        return;
      }
      cartList.innerHTML = state.cart.map(it => `
        <div class="row">
          <div style="flex:1">${it.title}</div>
          <div class="qty">
            <button onclick="dec('${it.id}')">‚àí</button>
            <b>${it.qty}</b>
            <button onclick="inc('${it.id}')">+</button>
          </div>
          <b>${money(it.price*it.qty)}</b>
        </div>
      `).join('');

      const total = state.cart.reduce((s,i)=>s+i.price*i.qty,0);
      totalBox.textContent = money(total);
    }

    /* ====== Drawer open/close ====== */
    const cart = document.getElementById('cart');
    const overlay = document.getElementById('overlay');
    const openBtn = document.getElementById('openCart');
    const closeBtn = document.getElementById('closeCart');

    function openCart(){
      cart.classList.add('drawer_open');
      overlay.classList.add('overlay_show');
    }
    function closeCart(){
      cart.classList.remove('drawer_open');
      overlay.classList.remove('overlay_show');
    }
    if(openBtn)  openBtn.addEventListener('click', openCart);
    if(closeBtn) closeBtn.addEventListener('click', closeCart);
    overlay.addEventListener('click', closeCart);
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeCart(); });

    /* ======================== 6) –û–¢–ü–†–ê–í–ö–ê –ó–ê–ö–ê–ó–ê ======================== */
    const form = document.getElementById('orderForm');

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();

      if(!state.cart.length){
        alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
        return;
      }

      const fd = new FormData(form);
      const customer = {
        name:     fd.get('name').trim(),
        username: (fd.get('username')||'').replace(/^@+/,'').trim(),
        phone:    fd.get('phone').trim(),
        address:  fd.get('address').trim(),
        comment:  fd.get('comment').trim()
      };

      // –ü—Ä–æ—Å—Ç–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–æ–ª–µ–π
      form.querySelectorAll('.danger').forEach(el=>el.classList.remove('danger'));
      if(!customer.name)   form.querySelector('[name=name]').classList.add('danger');
      if(!customer.phone)  form.querySelector('[name=phone]').classList.add('danger');
      if(!customer.name || !customer.phone) return;

      const order = {
        currency: 'Kƒç',
        total: state.cart.reduce((s,i)=>s+i.price*i.qty,0),
        payment: fd.get('payment'),
        delivery: fd.get('delivery'),
        items: state.cart.map(row => ({
          id: row.id,
          title: row.title,
          qty: row.qty,
          price_total: row.price*row.qty
        })),
        customer
      };

      try{
        const res = await fetch(API_URL, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(order)
        });
        const data = await res.json();
        if(!data.ok) throw new Error(data.error||'–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å');

        alert('–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!');
        state.cart = [];
        renderCart();
        closeCart();
        form.reset();
      }catch(err){
        console.error(err);
        alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: '+err.message);
      }
    });

    /* ======================== 7) INIT ======================== */
    tabs.addEventListener('click', (e)=>{
      const cat = e.target.dataset.cat;
      if(!cat) return;
      state.cat = cat;
      renderTabs(); renderGrid();
    });
    search.addEventListener('input', ()=>{ state.search = search.value; renderGrid(); });

    // —Å—Ç–∞—Ä—Ç
    renderTabs();
    renderGrid();
    renderCart();
  </script>
</body>
</html>
