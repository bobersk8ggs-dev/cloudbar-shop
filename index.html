<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CloudBar Shop</title>
  <style>
    :root{
      --bg:#0e0f12;
      --panel:#14161b;
      --accent:#7c4dff;
      --muted:#aeb4c2;
      --border:#2a2d35;
      --text:#eaeaea;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    .body-lock{ overflow:hidden; }

    /* --- APP BAR (—à–∞–ø–∫–∞) --- */
    .appbar{
      position:sticky; top:0; z-index:10;
      background:var(--panel);
      border-bottom:1px solid var(--border);
      padding:12px 16px;
      display:flex; gap:16px; align-items:center;
    }
    .brand{display:flex; align-items:center; gap:10px;}
    .logo{
      width:36px;height:36px;border-radius:12px;
      display:grid;place-items:center;font-weight:800;color:#fff;
      background:linear-gradient(135deg,#7c4dff 0%,#4dd0e1 100%);
      box-shadow:0 6px 16px rgba(124,77,255,.35);
    }
    .brand-text{line-height:1.05}
    .brand-text .word{
      font-weight:800; letter-spacing:.4px;
      background:linear-gradient(135deg,#a68cff 0%,#77e0ff 60%,#87f9d4 100%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      font-size:18px;
    }
    .brand-text .tag{font-size:12px; color:var(--muted)}
    .search-box{flex:1 1 auto; min-width:200px}
    .search-box input[type=search]{
      width:100%; background:#0e0f12; color:#eaeaea;
      border:1px solid var(--border); border-radius:12px; padding:10px 12px;
    }
    .header-actions{display:flex; align-items:center; gap:10px}
    .btn-icon{
      position:relative;
      background:#0e0f12; color:#fff;
      border:1px solid var(--border);
      padding:10px 12px; border-radius:12px; cursor:pointer;
    }
    .btn-icon:hover{border-color:var(--accent)}
    .badge{
      position:absolute; top:-6px; right:-6px;
      background:var(--accent); color:#fff;
      min-width:18px; height:18px; padding:0 5px;
      border-radius:9px; font-size:11px;
      display:grid; place-items:center;
    }

    /* --- –¢–∞–±—ã --- */
    .tabs{display:flex; gap:8px; flex-wrap:wrap; padding:10px 16px}
    .tab{
      padding:8px 12px;border:1px solid var(--border);border-radius:20px;
      cursor:pointer;font-size:14px;background:var(--panel);color:#fff;
    }
    .tab.active{ background:var(--accent); border-color:var(--accent) }

    /* ====== –ö–ê–¢–ê–õ–û–ì ====== */
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(230px,1fr));
      gap:16px; padding:16px;
    }
    .card{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:16px; overflow:hidden;
      display:flex; flex-direction:column;
      transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease;
    }
    .card:hover{
      transform:translateY(-2px);
      box-shadow:0 8px 28px rgba(0,0,0,.35);
      border-color:#2a2f3a;
    }
    .card.card--in{
      outline:1px solid var(--accent);
      box-shadow:0 0 0 3px rgba(124,77,255,.25);
    }
    .media{ aspect-ratio:1/1; background:#0e0f12; display:grid; place-items:center }
    .media img{ width:100%; height:100%; object-fit:contain; padding:12px }
    .meta{ padding:12px; display:flex; flex-direction:column; gap:8px }
    .title{ font-weight:800; min-height:40px }
    .price-row{ display:flex; align-items:center; justify-content:space-between }
    .btn{
      background:#0e0f12; color:#fff; border:1px solid var(--border);
      border-radius:10px; padding:8px 12px; cursor:pointer;
    }
    .btn-primary{ background:var(--accent); border-color:var(--accent) }
    .qty{ display:flex; align-items:center; gap:8px; }
    .qty button{
      width:28px; height:28px; border-radius:8px;
      background:#14161d; color:#fff; border:1px solid var(--border);
    }
    .qty .num{ min-width:26px; text-align:center }

    /* –¢–æ—Å—Ç */
    .toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%) translateY(12px);
      background:#14161d; color:#fff; border:1px solid var(--border);
      padding:10px 14px; border-radius:10px;
      opacity:0; pointer-events:none; transition:.18s ease; z-index:50;
    }
    .toast_show{ opacity:1; transform:translateX(-50%) translateY(0) }

    /* ====== –í–´–ï–ó–ñ–ê–Æ–©–ê–Ø –ö–û–†–ó–ò–ù–ê ====== */
    .drawer{
      position:fixed; right:0; top:0; bottom:0;
      width:380px; max-width:100%;
      background:var(--panel);
      border-left:1px solid var(--border);
      transform:translateX(100%); transition:transform .25s ease;
      z-index:1000; display:flex; flex-direction:column;
    }
    .drawer_open{ transform:translateX(0); }
    .drawer header{
      position:sticky; top:0; z-index:1;
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 16px; background:var(--panel);
      border-bottom:1px solid var(--border);
    }
    .drawer header .close{
      width:34px; height:34px; border-radius:8px;
      background:transparent; border:1px solid var(--border); color:#fff; cursor:pointer;
    }
    .cart-list{ padding:12px; display:flex; flex-direction:column; gap:12px; overflow:auto }
    .cart-row{
      background:#0e0f12; border:1px solid var(--border); border-radius:12px;
      padding:8px 10px; display:grid; grid-template-columns:56px 1fr auto auto auto;
      align-items:center; gap:12px;
    }
    .cart-row img{ width:56px; height:56px; object-fit:contain }
    .cr-meta{ display:flex; flex-direction:column; gap:4px }
    .cr-title{ font-weight:800 }
    .cr-sub{ font-size:12px; color:var(--muted) }
    .cr-qty{ display:flex; align-items:center; gap:8px }
    .cr-qty button{
      width:26px; height:26px; border-radius:8px;
      background:#14161d; color:#fff; border:1px solid var(--border);
    }
    .cr-sum{ font-weight:800 }
    .cr-del{ background:transparent; border:0; color:#999; font-size:18px; cursor:pointer; }
    .cr-del:hover{ color:#fff }

    .panel{ padding:12px; display:flex; flex-direction:column; gap:10px }
    select, textarea, input[type=text], input[type=tel]{
      width:100%; background:#0e0f12; color:#eaeaea;
      border:1px solid var(--border); border-radius:10px; padding:10px;
    }
    textarea{ min-height:90px; resize:vertical }
    .total{ padding:12px; border-top:1px solid var(--border); font-weight:700 }

    /* Overlay */
    .overlay{
      position:fixed; inset:0; background:#0008;
      opacity:0; pointer-events:none; transition:opacity .25s; z-index:999;
    }
    .overlay_show{ opacity:1; pointer-events:auto }
  </style>
</head>
<body>

  <!-- –®–∞–ø–∫–∞ -->
  <header class="appbar">
    <div class="brand">
      <div class="logo">CB</div>
      <div class="brand-text">
        <div class="word">CloudBar</div>
        <div class="tag">mini shop</div>
      </div>
    </div>

    <div class="search-box">
      <input id="search" type="search" placeholder="–ü–æ–∏—Å–∫ –≤–∫—É—Å–∞..." />
    </div>

    <div class="header-actions">
      <button class="btn-icon" id="hdrCartBtn" aria-label="–ö–æ—Ä–∑–∏–Ω–∞">
        üõí
        <span class="badge" id="cartCount" hidden>0</span>
      </button>
    </div>
  </header>

  <!-- –¢–∞–±—ã -->
  <div class="tabs" id="tabs"></div>

  <!-- –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
  <div class="grid" id="grid"></div>

  <!-- Overlay -->
  <div class="overlay" id="overlay"></div>

  <!-- –í—ã–µ–∑–∂–∞—é—â–∞—è –∫–æ—Ä–∑–∏–Ω–∞ -->
  <aside class="drawer" id="cart">
    <header>
      <div><b>–ö–æ—Ä–∑–∏–Ω–∞</b></div>
      <button class="close" id="closeCart">‚úï</button>
    </header>

    <div class="cart-list" id="cartList"></div>

    <div class="panel">
      <select id="paymentSel">
        <option>–û–Ω–ª–∞–π–Ω-–ø–µ—Ä–µ–≤–æ–¥–æ–º</option>
        <option>–ù–∞–ª–∏—á–Ω—ã–º–∏ –∫—É—Ä—å–µ—Ä—É</option>
      </select>
      <select id="deliverySel">
        <option>–î–æ—Å—Ç–∞–≤–∫–∞</option>
        <option>–°–∞–º–æ–≤—ã–≤–æ–∑</option>
      </select>

      <input id="nameInput" type="text" placeholder="–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è" required />
      <input id="usernameInput" type="text" placeholder="@username –≤ Telegram (–ø–æ –∂–µ–ª–∞–Ω–∏—é)" />
      <input id="phoneInput" type="tel" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required />
      <input id="addressInput" type="text" placeholder="–ê–¥—Ä–µ—Å" />
      <textarea id="commentInput" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>

      <button id="sendBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>

    <div class="total" id="totalBox">–ò—Ç–æ–≥–æ: 0 Kƒç</div>
  </aside>

  <!-- –¢–æ—Å—Ç -->
  <div id="toast" class="toast"></div>

  <script>
    /* =================== –ù–ê–°–¢–†–û–ô–ö–ê =================== */
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbx4P7kHLxXLoKydNMzkqOumae5FpXyNACs1iI7MbBSsDBNNpvQsSby0njaB3BjNbMeRsQ/exec'; // ‚Üê –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π /exec
    const CURRENCY = 'Kƒç';

    /* =================== –î–ê–ù–ù–´–ï =================== */
    const products = [
      { id:1, title:'VOEX Blueberry Bubble Gum', price:300, cat:'VOEX Blueberry Bubble Gum', img:'img/blueberry-bubble-gum.jpg.jpg' },
      { id:2, title:'VOEX Blueberry Coconut',    price:300, cat:'VOEX Blueberry Coconut',    img:'img/blueberry-coconut.jpg.jpg'   },
      { id:3, title:'VOEX Green Grape Rose',     price:300, cat:'VOEX Green Grape Rose',     img:'img/green-grape-rose.jpg.jpg'   },
      { id:4, title:'VOEX Jasmine Raspberry',    price:300, cat:'VOEX Jasmine Raspberry',    img:'img/jasmine-raspberry.jpg.jpg'  },
      { id:5, title:'VOEX Pink Lemonade',        price:300, cat:'VOEX Pink Lemonade',        img:'img/pink-lemonade.jpg.jpg'      },
    ];

    /* =================== STATE/DOM =================== */
    const state = { cat:'all', q:'', cart:[] }; // cart: [{id, qty}]
    const $ = s => document.querySelector(s);

    const tabsEl = $('#tabs');
    const gridEl = $('#grid');
    const searchEl = $('#search');

    const cartEl = $('#cart');
    const overlay = $('#overlay');
    const closeBtn = $('#closeCart');
    const hdrCartBtn = $('#hdrCartBtn');
    const cartCountEl = $('#cartCount');

    const cartListEl = $('#cartList');
    const totalBox = $('#totalBox');

    const paymentSel   = $('#paymentSel');
    const deliverySel  = $('#deliverySel');
    const nameInput    = $('#nameInput');
    const usernameInput= $('#usernameInput');
    const phoneInput   = $('#phoneInput');
    const addressInput = $('#addressInput');
    const commentInput = $('#commentInput');
    const sendBtn      = $('#sendBtn');

    /* =================== HELPERS =================== */
    const money = v => `${v} ${CURRENCY}`;
    const getItem = id => products.find(p=>p.id===id) || null;
    const inCartQty = id => (state.cart.find(i=>i.id===id)?.qty || 0);

    let _toastTimer;
    function toast(msg){
      const el = $('#toast'); if(!el) return;
      el.textContent = msg;
      el.classList.add('toast_show');
      clearTimeout(_toastTimer);
      _toastTimer = setTimeout(()=> el.classList.remove('toast_show'), 1400);
    }

    /* =================== TABS/SEARCH =================== */
    function renderTabs(){
      const cats = ['all','VOEX Blueberry Bubble Gum','VOEX Blueberry Coconut','VOEX Green Grape Rose','VOEX Jasmine Raspberry','VOEX Pink Lemonade'];
      const names = { all:'–í—Å–µ' };
      tabsEl.innerHTML = cats.map(c => `
        <div class="tab ${state.cat===c?'active':''}" data-cat="${c}">
          ${names[c] || c}
        </div>
      `).join('');
    }

    function filtered(){
      const q = state.q.trim().toLowerCase();
      return products.filter(p =>
        (state.cat==='all' || p.cat===state.cat) &&
        (!q || p.title.toLowerCase().includes(q))
      );
    }

    /* =================== GRID =================== */
    function renderGrid(){
      const list = filtered();
      gridEl.innerHTML = list.map(p=>{
        const qty = inCartQty(p.id);
        return `
          <div class="card ${qty ? 'card--in':''}">
            <div class="media">
              <img src="${p.img}" alt="${p.title}">
            </div>
            <div class="meta">
              <div class="title">${p.title}</div>
              <div class="price-row">
                <b>${money(p.price)}</b>
                ${
                  qty === 0
                  ? `<button class="btn btn-primary" onclick="addToCart(${p.id})">–í –∫–æ—Ä–∑–∏–Ω—É</button>`
                  : `<div class="qty">
                        <button onclick="decQty(${p.id})">‚àí</button>
                        <span class="num">${qty}</span>
                        <button onclick="incQty(${p.id})">+</button>
                     </div>`
                }
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    /* =================== CART =================== */
    function updateCartBadge(){
      const count = state.cart.reduce((s,i)=>s+i.qty,0);
      if(count>0){ cartCountEl.textContent = count; cartCountEl.hidden = false; }
      else { cartCountEl.hidden = true; }
    }

    function renderCart(){
      if(state.cart.length===0){
        cartListEl.innerHTML = `<div class="muted">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è</div>`;
        totalBox.textContent = '–ò—Ç–æ–≥–æ: ' + money(0);
        updateCartBadge();
        return;
      }

      const rows = state.cart.map(ci=>{
        const p = getItem(ci.id); if(!p) return '';
        const line = p.price * ci.qty;
        return `
          <div class="cart-row">
            <img src="${p.img}" alt="${p.title}">
            <div class="cr-meta">
              <div class="cr-title">${p.title}</div>
              <div class="cr-sub">${money(p.price)} √ó ${ci.qty}</div>
            </div>
            <div class="cr-qty">
              <button onclick="decQty(${p.id})">‚àí</button>
              <span>${ci.qty}</span>
              <button onclick="incQty(${p.id})">+</button>
            </div>
            <div class="cr-sum">${money(line)}</div>
            <button class="cr-del" title="–£–¥–∞–ª–∏—Ç—å" onclick="removeFromCart(${p.id})">√ó</button>
          </div>
        `;
      }).join('');

      cartListEl.innerHTML = rows;

      const total = state.cart.reduce((s,i)=>{
        const p = getItem(i.id); return s + (p ? p.price*i.qty : 0);
      },0);
      totalBox.textContent = '–ò—Ç–æ–≥–æ: ' + money(total);
      updateCartBadge();
    }

    /* –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–æ—Ä–∑–∏–Ω–æ–π */
    function addToCart(id){
      const pos = state.cart.findIndex(i=>i.id===id);
      if(pos<0) state.cart.push({id, qty:1});
      else state.cart[pos].qty++;
      renderGrid(); renderCart(); toast('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É'); openCart();
    }
    function incQty(id){
      const row = state.cart.find(i=>i.id===id);
      if(!row){ addToCart(id); return; }
      row.qty++; renderGrid(); renderCart();
    }
    function decQty(id){
      const row = state.cart.find(i=>i.id===id);
      if(!row) return;
      row.qty--;
      if(row.qty<=0) state.cart = state.cart.filter(i=>i.id!==id);
      renderGrid(); renderCart();
    }
    function removeFromCart(id){
      state.cart = state.cart.filter(i=>i.id!==id);
      renderGrid(); renderCart();
    }

    /* =================== DRAWER =================== */
    function openCart(){
      cartEl.classList.add('drawer_open');
      overlay.classList.add('overlay_show');
      document.body.classList.add('body-lock');
    }
    function closeCart(){
      cartEl.classList.remove('drawer_open');
      overlay.classList.remove('overlay_show');
      document.body.classList.remove('body-lock');
    }
    hdrCartBtn.addEventListener('click', openCart);
    closeBtn.addEventListener('click', closeCart);
    overlay.addEventListener('click', closeCart);
    document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeCart(); });

    /* =================== SEND ORDER =================== */
    async function sendOrder(){
      if(!state.cart.length){ alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'); return; }

      const order = {
        items: state.cart.map(it=>{
          const p = getItem(it.id);
          return { id: it.id, title: p?.title || '', qty: it.qty, price_total: (p?.price||0)*it.qty };
        }),
        customer:{
          name: nameInput.value.trim(),
          username: (usernameInput.value||'').replace(/^@+/,'').trim(),
          phone: phoneInput.value.trim(),
          address: addressInput.value.trim(),
          comment: commentInput.value.trim()
        },
        payment: paymentSel.value,
        delivery: deliverySel.value,
        currency: CURRENCY,
        total: state.cart.reduce((s,i)=>s+(getItem(i.id)?.price||0)*i.qty,0)
      };

      try{
        await fetch(WEB_APP_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify(order)
        });
        alert('‚úÖ –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!');
        state.cart = []; renderGrid(); renderCart(); closeCart();
      }catch(err){
        console.error(err);
        alert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: '+err.message);
      }
    }

    sendBtn.addEventListener('click', sendOrder);

    /* =================== INIT =================== */
    tabsEl.addEventListener('click', (e)=>{
      const el = e.target.closest('.tab'); if(!el) return;
      state.cat = el.dataset.cat; renderTabs(); renderGrid();
    });
    searchEl.addEventListener('input', ()=>{
      state.q = searchEl.value; renderGrid();
    });

    renderTabs(); renderGrid(); renderCart();
  </script>
</body>
</html>
